This branch restores the working state from PR #345 (commit 7669f4bd)
Created to provide a clean merge point without conflicts.
